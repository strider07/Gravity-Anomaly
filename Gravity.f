      PROGRAM GRAVITY
      IMPLICIT REAL*8(A-H,L,O-Z)

      READ (*,*) N
      OPEN (2,FILE='gravity data.txt',FORM='FORMATTED',STATUS='OLD')
      OPEN (3,FILE='RESULTS.txt',FORM='FORMATTED',STATUS='NEW')
      OPEN (4,FILE='GRAVITY.txt',FORM='FORMATTED',STATUS='NEW')
      OPEN (5,FILE='NORMAL GRAVITY.txt',FORM='FORMATTED',STATUS='NEW')
      OPEN (6,FILE='FREE AIR ANOMALY.txt',FORM='FORMATTED',STATUS='NEW')
      OPEN (7,FILE='BOUGUER ANOMALY.txt',FORM='FORMATTED',STATUS='NEW')
      WRITE(3,15)
      WRITE(4,16)
      WRITE(5,17)
      WRITE(6,18)
      WRITE(7,19)
   15 FORMAT('STATION ID   LATITUDE     LONGITUDE  GRAVITY  NORMAL GRAVI
     1TY  FREE AIR  ANOMALY   BOUGUER ANOMALY  UTM-X   UTM-Y')
   16 FORMAT('STATION ID   LATITUDE     LONGITUDE  GRAVITY')
   17 FORMAT('STATION ID   LATITUDE     LONGITUDE    NORMAL GRAVITY')
   18 FORMAT('STATION ID   LATITUDE     LONGITUDE    FREE AIR ANOMALY')
   19 FORMAT('STATION ID   LATITUDE     LONGITUDE    BOUGUER ANOMALY')
      DO 30 I = 1,N
      READ(2,*)ID, PHI, AA, LONG, BB, H, G
      AA = AA/60
      PHI = AA+PHI
      BB = BB/60
      LONG = LONG + BB
      IF (BB.GE.60) THEN
         G= BB*60
         H= LONG - BB
         LONG= 0
      ENDIF
C    5 FORMAT(F10.2)
      CALL NORMAL(PHI, GAMMA)
      CALL UTM(PHI,LONG,H,UTMX,UTMY)
      FAG = G + 0.3086*H
      FA = FAG - GAMMA
      BO = FAG - 0.1119D0*H  - GAMMA

      WRITE (3,20)ID, PHI, LONG, G, GAMMA, FA, BO,  UTMX,  UTMY
      WRITE (4,40)ID, PHI, LONG, G
      WRITE (5,50)ID, PHI, LONG, GAMMA
      WRITE (6,60)ID, PHI, LONG, FA
      WRITE (7,70)ID, PHI, LONG, BO
   20 FORMAT(I6,5F13.2, F21.2, 2F20.4)
   40 FORMAT (I6,3F13.2)
   50 FORMAT (I6,2F13.2,F18.2)
   60 FORMAT (I6,2F13.2,F19.2)
   70 FORMAT (I6,2F13.2,F18.2)
   30 CONTINUE
      WRITE(3,*)'_______________________________________________________
     1_________________________________________________'
      WRITE(3,*)
      WRITE(3,*)'       IGNOR ANY LONGITUDE VALUE THAT IS EQUAL TO ZERO'
      STOP
      END
      
      SUBROUTINE NORMAL(PHI, GAMMA)
      IMPLICIT REAL*8(A-H, O-Z)
      A = 6378137.0D0
      B = 6356752.3142D0
      ESQR = 6.69437999014D-03
      GAMMAP = 9.8321849378D0
      GAMMAE = 9.7803253359D0
      TK = 2*(667.2 *(10**(-13))* 3.14159265389793D0)
      DPHI = (PHI*3.14159265389793D0)/180
      GAMMA = GAMMAE *(1 + TK*(DSIN(DPHI))**2)/(DSQRT(1.D0
     1 - ESQR*(DSIN(DPHI))**2))
      GAMMA = GAMMA*1.D05
      RETURN
      END
      
      
      SUBROUTINE UTM(PHI,LONG,H,UTMX,UTMY)
      IMPLICIT REAL*8(A-H, O-Z)
      SEMIA= 6378137
      FLAT= 1/298.25722357
      ECEN= 2*FLAT-(FLAT**2)
      DPHI = (PHI*3.14159265389793D0)/180
      PRIME=SEMIA/(1-(ECEN*(DSIN(DPHI))**2))**0.5
      DLONG = (LONG*3.14159265389793D0)/180
      UTMX=(PRIME+H)*DCOS(DPHI)*DCOS(DLONG)
      UTMY=(PRIME+H)*DCOS(DPHI)*DSIN(DLONG)
      RETURN
      END
